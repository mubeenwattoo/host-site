<!DOCTYPE html>
<html>

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6ZY1KSD55X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-6ZY1KSD55X');
  </script>
  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '409710449219518');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=409710449219518&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="./assets/css/output.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">

<title>Guest Survey Page 7</title>
<!-- Contentsquare (Hotjar) Tracking -->
<script src="https://t.contentsquare.net/uxa/ce07a67e879d5.js"></script>
</head>
<body class="font-[lexend]">

 <section class="gradient-bg pt-8  lg:px-[64px] lg:pb-[48px] pb-[24px] p-6 ">
  <div class="max-w-[1440px] mx-auto">
<a href="https://www.nesthelpers.com/helpers" class="inline-flex"><img src="./assets/images/logo.png" alt="logo" class="lg:w-[124px] lg:h-[48px] w-[82px] h-[32px] "></a>


      <h2 class="text-[#5B7B5A] lg:text-[48px] text-[24px] font-[500] lg:mb-10 mb-6 lg:mt-6 mt-12 text-center">Let us find a <br class="lg:hidden block"> great home for you</h2>

  <div class=" mx-auto grid lg:grid-cols-[300px_1fr] gap-32">

    <div class="lg:flex hidden flex-col gap-10">

      <!-- Step 1 -->
      <div class="flex flex-col items-start  gap-3 p-6 rounded-[14px] border-[2px] border-[var(--Color-Green,#5B7B5A)]
  bg-[var(--Color-Light-Green,#D9E1CE)] shadow-[0_20px_25px_-5px_rgba(0,0,0,0.10),_0_8px_10px_-6px_rgba(0,0,0,0.10)] ">
          <span class="mx-auto w-12 h-12 rounded-full bg-[#5B7B5A] text-[24px] font-[300] text-white flex items-center justify-center ">1</span>

            <h3 class="text-[#2D2D2D]  text-[24px] font-[500] mt-3 ">Create Your Profile</h3>
            <p class="text-[#675F57] text-[16px] font-[400]">Tell us about yourself and preferences</p>
      </div>

       <div class="flex flex-col items-start  gap-3 p-6 
  rounded-[14px]
  border-[2px]
  border-[var(--Color-Dark-Brown-30,rgba(103,95,87,0.30))]
  bg-[var(--Color-White-10,rgba(255,255,255,0.10))]
  shadow-[0_20px_25px_-5px_rgba(0,0,0,0.10),_0_8px_10px_-6px_rgba(0,0,0,0.10)]">
          <span class="mx-auto w-12 h-12 rounded-full bg-[var(--Color-White,#FFF)]
  shadow-[0_0_0_2.4px_#FAF8F6,_
          0_6px_9px_-1.8px_rgba(0,0,0,0.10),_
          0_2.4px_3.6px_-2.4px_rgba(0,0,0,0.10)] text-[24px] font-[300] text-[#5B7B5A] flex items-center justify-center ">2</span>

            <h3 class="text-[#2D2D2D]  text-[24px] font-[500] mt-3 ">Get Matched</h3>
            <p class="text-[#675F57] text-[16px] font-[400]">We connect you with households that fit your lifestyle</p>
      </div>
        <div class="flex flex-col items-start  gap-3 p-6 
  rounded-[14px]
  border-[2px]
  border-[var(--Color-Dark-Brown-30,rgba(103,95,87,0.30))]
  bg-[var(--Color-White-10,rgba(255,255,255,0.10))]
  shadow-[0_20px_25px_-5px_rgba(0,0,0,0.10),_0_8px_10px_-6px_rgba(0,0,0,0.10)]">
          <span class="mx-auto w-12 h-12 rounded-full bg-[var(--Color-White,#FFF)]
  shadow-[0_0_0_2.4px_#FAF8F6,_
          0_6px_9px_-1.8px_rgba(0,0,0,0.10),_
          0_2.4px_3.6px_-2.4px_rgba(0,0,0,0.10)] text-[24px] font-[300] text-[#5B7B5A] flex items-center justify-center ">3</span>

            <h3 class="text-[#2D2D2D]  text-[24px] font-[500] mt-3 ">Interview</h3>
            <p class="text-[#675F57] text-[16px] font-[400]">Meet the family, agree on expectations, and move into your new home</p>
      </div>

     

    </div>

    <div>
      <form id="surveyForm7" method="post">
      <div class="flex flex-col lg:gap-10 gap-6">
<div class="flex items-center gap-6  w-full">
<div x-data="{ on: false }" class="select-none cursor-pointer" data-toggle-id="pets-children">
  <div 
    @click="on = !on"
    class="relative lg:w-[90px] w-[85px] h-[34px] flex items-center rounded-full border-[2px] transition-all duration-300"
    :class="on ? 'bg-[#675F57] border-[#675F57]' : 'bg-white border-[#675F57]'"
  >

      <div 
        class="absolute lg:w-[26px] lg:h-[26px] w-[22px] h-[22px] rounded-full transition-all duration-300 transform"
        style="left:4px;" 
        :class="on 
          ? 'translate-x-[52px] bg-white' 
          : 'translate-x-0 bg-[#675F57]'"
      ></div>

      <span 
        class="absolute lg:text-[20px] text-[16px] font-[400]  transition-all duration-300"
        :class="on 
          ? 'left-[14px] text-white' 
          : 'right-[14px] text-[#675F57]'"
        x-text="on ? 'Yes' : 'No'"
      ></span>

      <input type="hidden" name="data[Pets]" data-toggle="pets-children" :value="on ? 'Yes' : 'No'">
  </div>
</div>
<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400]">
    Do you have any pets or children living with you?
  </span>
</div>
<div class="flex items-center gap-6  w-full">
<div x-data="{ on: false }" class="select-none cursor-pointer" data-toggle-id="additional-pay">
  <div 
    @click="on = !on"
    class="relative lg:w-[90px] w-[85px] h-[34px] flex items-center rounded-full border-[2px] transition-all duration-300"
    :class="on ? 'bg-[#675F57] border-[#675F57]' : 'bg-white border-[#675F57]'"
  >

      <div 
        class="absolute lg:w-[26px] lg:h-[26px] w-[22px] h-[22px] rounded-full transition-all duration-300 transform"
        style="left:4px;" 
        :class="on 
          ? 'translate-x-[52px] bg-white' 
          : 'translate-x-0 bg-[#675F57]'"
      ></div>

      <span 
        class="absolute lg:text-[20px] text-[16px] font-[400]  transition-all duration-300"
        :class="on 
          ? 'left-[14px] text-white' 
          : 'right-[14px] text-[#675F57]'"
        x-text="on ? 'Yes' : 'No'"
      ></span>

      <input type="hidden" name="data[Contribute]" data-toggle="additional-pay" :value="on ? 'Yes' : 'No'">
  </div>
</div>
<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400]">
    You're expected to contribute up to 10 hours of household assistance per week. Would you be interested in receiving additional hourly pay to provide assistance beyond 10 hours?
  </span>
</div>
<div class="flex items-center gap-6  w-full">
<div x-data="{ on: false }" class="select-none cursor-pointer" data-toggle-id="owns-car">
  <div 
    @click="on = !on"
    class="relative lg:w-[90px] w-[85px] h-[34px] flex items-center rounded-full border-[2px] transition-all duration-300"
    :class="on ? 'bg-[#675F57] border-[#675F57]' : 'bg-white border-[#675F57]'"
  >

      <div 
        class="absolute lg:w-[26px] lg:h-[26px] w-[22px] h-[22px] rounded-full transition-all duration-300 transform"
        style="left:4px;" 
        :class="on 
          ? 'translate-x-[52px] bg-white' 
          : 'translate-x-0 bg-[#675F57]'"
      ></div>

      <span 
        class="absolute lg:text-[20px] text-[16px] font-[400]  transition-all duration-300"
        :class="on 
          ? 'left-[14px] text-white' 
          : 'right-[14px] text-[#675F57]'"
        x-text="on ? 'Yes' : 'No'"
      ></span>

      <input type="hidden" name="data[Car]" data-toggle="owns-car" :value="on ? 'Yes' : 'No'">
  </div>
</div>
<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400]">
Do you own a car?
</span>
</div>
<div class="flex items-center gap-6  w-full">
<div x-data="{ on: false }" class="select-none cursor-pointer" data-toggle-id="has-references">
  <div 
    @click="on = !on"
    class="relative lg:w-[90px] w-[85px] h-[34px] flex items-center rounded-full border-[2px] transition-all duration-300"
    :class="on ? 'bg-[#675F57] border-[#675F57]' : 'bg-white border-[#675F57]'"
  >

      <div 
        class="absolute lg:w-[26px] lg:h-[26px] w-[22px] h-[22px] rounded-full transition-all duration-300 transform"
        style="left:4px;" 
        :class="on 
          ? 'translate-x-[52px] bg-white' 
          : 'translate-x-0 bg-[#675F57]'"
      ></div>

      <span 
        class="absolute lg:text-[20px] text-[16px] font-[400]  transition-all duration-300"
        :class="on 
          ? 'left-[14px] text-white' 
          : 'right-[14px] text-[#675F57]'"
        x-text="on ? 'Yes' : 'No'"
      ></span>

      <input type="hidden" name="data[Reference]" data-toggle="has-references" :value="on ? 'Yes' : 'No'">
  </div>
</div>
<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400]">
Do you have references that would vouch for you as a reliable and competent helper?
</span>
</div>
<div class="flex items-center gap-6  w-full">
<div x-data="{ on: false }" class="select-none cursor-pointer" data-toggle-id="has-degree">
  <div 
    @click="on = !on"
    class="relative lg:w-[90px] w-[85px] h-[34px] flex items-center rounded-full border-[2px] transition-all duration-300"
    :class="on ? 'bg-[#675F57] border-[#675F57]' : 'bg-white border-[#675F57]'"
  >

      <div 
        class="absolute lg:w-[26px] lg:h-[26px] w-[22px] h-[22px] rounded-full transition-all duration-300 transform"
        style="left:4px;" 
        :class="on 
          ? 'translate-x-[52px] bg-white' 
          : 'translate-x-0 bg-[#675F57]'"
      ></div>

      <span 
        class="absolute lg:text-[20px] text-[16px] font-[400]  transition-all duration-300"
        :class="on 
          ? 'left-[14px] text-white' 
          : 'right-[14px] text-[#675F57]'"
        x-text="on ? 'Yes' : 'No'"
      ></span>

      <input type="hidden" name="data[Degree]" data-toggle="has-degree" :value="on ? 'Yes' : 'No'">
  </div>
</div>
<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400]">
Do you have a college degree?
</span>
</div>
<div class="flex lg:items-end  lg:flex-row flex-col items-center lg:gap-12 gap-0 lg:mt-0 mt-6  w-full">

<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400]">
Current zip code where you live
</span>
<div class="flex flex-col lg:mt-0 mt-4 w-full lg:w-auto">
 <input id="zipCodeInput" name="data[Zip]" type="text" inputmode="numeric" pattern="[0-9]{5}" maxlength="5" class="p-3 text-[20px] lg:placeholder:text-[20px] 
         placeholder:text-[16px] font-[400] text-center lg:pb-2 pb-4 whitespace-normal placeholder:whitespace-normal
               border-b border-[#675F57] focus:outline-0 focus:border-[#795634] text-[#4A4A4A] placeholder-[rgba(103,95,87,0.30)]"
               placeholder="5 digit US zip code">
 <span id="zipCodeError" class="text-red-500 text-[14px] font-[400] mt-1 text-center hidden">Please correct zip code</span>
</div>

</div>

<div class="flex lg:items-end lg:flex-row xl:gap-36 flex-col items-center lg:gap-12 gap-0 lg:mt-0 mt-6  w-full">

<span class="text-[#2D2D2D] lg:text-[20px] text-[16px] font-[400] xl:whitespace-nowrap">
Your name and email
</span>
<div class="flex items-center lg:flex-row flex-col lg:justify-between lg:gap-6">
 <input id="firstNameInput" name="data[Name]" type="text" class=" lg:mt-0 mt-4 lg:w-[200px] p-3 text-[20px] lg:placeholder:text-[20px] 
         placeholder:text-[16px] font-[400] text-center lg:pb-2 pb-4 whitespace-normal placeholder:whitespace-normal
               border-b border-[#675F57] focus:outline-0 focus:border-[#795634] text-[#4A4A4A] placeholder-[rgba(103,95,87,0.30)]"
               placeholder="First Name">
               <input id="emailInput" name="data[Email]" type="email" required class=" lg:w-[216px] lg:mt-0 mt-4  p-3 text-[20px] lg:placeholder:text-[20px] 
         placeholder:text-[16px] font-[400] text-center lg:pb-2 pb-4 whitespace-normal placeholder:whitespace-normal
               border-b border-[#675F57] focus:outline-0 focus:border-[#795634] text-[#4A4A4A] placeholder-[rgba(103,95,87,0.30)]"
               placeholder="Email">
               </div>

</div>



</div>
       
     
   

      <!-- BUTTON -->
      <div class="lg:mt-16  mx-auto relative flex items-center gap-8 justify-center">
 <a href="./guest-survey-page-1.html" class="lg:flex hidden"><img src="./assets/images/back-button.png" alt="back-button" class="w-auto lg:mt-6 hover:opacity-70 duration-300"></a>


         <input type="submit" id="submitBtn" value="Submit" class="cursor-not-allowed duration-300 opacity-30  lg:text-[24px] text-[16px] font-[500] shadow-[0_10px_15px_-3px_rgba(0,0,0,0.10),_0_4px_6px_-4px_rgba(0,0,0,0.10)] lg:w-[450px] w-[85%] mx-auto flex items-center justify-center lg:mx-0 lg:mt-0 mt-10 bg-[#BE5103]  text-white  px-4 py-3 rounded-full ">
          
      </div>
      </form>

    </div>
  </div>
  </div>
</section>




<footer class="w-full bg-[#2E2E2E] pt-[42px] pb-[32px] lg:px-[64px] px-[24px]">
  <div class="w-full mx-auto text-center">

<img src="./assets/images/logo.png" alt="logo" class="lg:w-[124px] lg:h-[48px] w-[82px] h-[32px] mx-auto ">


    <hr class="border-[#7D7A74] lg:mb-12 mb-6 lg:mt-10 mt-5">

    <p class="text-[#7D7A74] text-[16px] font-[400]">
      Â© 2025 NestHelpers. All rights reserved.
    </p>
  </div>
</footer>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const submitBtn = document.getElementById("submitBtn");
  if (!submitBtn) return;


  // Function to check if all form requirements are met
  function checkFormValidity() {
    // Check all input fields are filled
    const zipCode = document.getElementById("zipCodeInput");
    const firstName = document.getElementById("firstNameInput");
    const email = document.getElementById("emailInput");

    // Validate zip code is exactly 5 digits
    const zipCodeValid = zipCode && zipCode.value.trim() !== '' && /^\d{5}$/.test(zipCode.value.trim());

    const allInputsFilled = 
      zipCodeValid &&
      firstName && firstName.value.trim() !== '' &&
      email && email.value.trim() !== '';

    // Enable button if all input conditions are met (toggles are now optional)
    if (allInputsFilled) {
      submitBtn.classList.remove("opacity-30", "cursor-not-allowed");
      submitBtn.classList.add("opacity-100", "cursor-pointer");
    } else {
      submitBtn.classList.remove("opacity-100", "cursor-pointer");
      submitBtn.classList.add("opacity-30", "cursor-not-allowed");
    }
  }

  // Zip code validation - only allow digits and limit to 5
  const zipCode = document.getElementById("zipCodeInput");
  const zipCodeError = document.getElementById("zipCodeError");
  
  function validateZipCode() {
    const zipValue = zipCode.value.trim();
    const isValid = /^\d{5}$/.test(zipValue);
    
    if (zipValue === '') {
      // Empty - no error shown yet
      zipCode.style.borderColor = '#675F57';
      zipCodeError.classList.add('hidden');
      return false;
    } else if (!isValid) {
      // Invalid - show error
      zipCode.style.borderColor = '#EF4444'; // red-500
      zipCodeError.classList.remove('hidden');
      return false;
    } else {
      // Valid - hide error
      zipCode.style.borderColor = '#675F57';
      zipCodeError.classList.add('hidden');
      return true;
    }
  }
  
  if (zipCode) {
    zipCode.addEventListener('input', (e) => {
      // Remove any non-digit characters
      e.target.value = e.target.value.replace(/\D/g, '');
      // Limit to 5 digits
      if (e.target.value.length > 5) {
        e.target.value = e.target.value.slice(0, 5);
      }
      validateZipCode();
      checkFormValidity();
    });
    
    zipCode.addEventListener('blur', () => {
      validateZipCode();
      checkFormValidity();
    });
    
    zipCode.addEventListener('paste', (e) => {
      e.preventDefault();
      const pastedText = (e.clipboardData || window.clipboardData).getData('text');
      const digitsOnly = pastedText.replace(/\D/g, '').slice(0, 5);
      e.target.value = digitsOnly;
      validateZipCode();
      checkFormValidity();
    });
  }

  // Listen for input field changes
  const firstName = document.getElementById("firstNameInput");
  const email = document.getElementById("emailInput");

  if (firstName) {
    firstName.addEventListener('input', checkFormValidity);
    firstName.addEventListener('change', checkFormValidity);
  }
  
  if (email) {
    email.addEventListener('input', checkFormValidity);
    email.addEventListener('change', checkFormValidity);
  }

  // Initial check after DOM is ready (wait for Alpine.js to initialize)
  setTimeout(checkFormValidity, 200);
  
  // Also check periodically to catch Alpine.js updates
  setInterval(checkFormValidity, 500);
  
  // Email validation on input
  const emailInput = document.getElementById("emailInput");
  if (emailInput) {
    emailInput.addEventListener('blur', () => {
      const email = emailInput.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (email && !emailRegex.test(email)) {
        emailInput.style.borderColor = '#BE5103';
        emailInput.setCustomValidity('Please enter a valid email address');
        emailInput.reportValidity();
      } else {
        emailInput.style.borderColor = '';
        emailInput.setCustomValidity('');
      }
      checkFormValidity();
    });
    
    emailInput.addEventListener('input', () => {
      emailInput.setCustomValidity('');
      emailInput.style.borderColor = '';
      checkFormValidity();
    });
  }
  
  // Fix degree toggle - sync all toggle values before form submission
  // This ensures Alpine.js values are properly captured
  function syncAllToggleValues() {
    document.querySelectorAll('[x-data*="on"]').forEach(toggleContainer => {
      const hiddenInput = toggleContainer.querySelector('input[type="hidden"]');
      if (hiddenInput) {
        let valueSet = false;
        
        // Method 1: Try to get Alpine.js data directly
        try {
          if (window.Alpine && Alpine.$data) {
            const alpineData = Alpine.$data(toggleContainer);
            if (alpineData && typeof alpineData.on !== 'undefined') {
              hiddenInput.value = alpineData.on ? 'Yes' : 'No';
              valueSet = true;
            }
          }
        } catch (e) {
          // Fall through to visual check
        }
        
        // Method 2: Check the toggle state visually (reliable fallback)
        if (!valueSet) {
          const toggleDiv = toggleContainer.querySelector('div[class*="bg-"]');
          if (toggleDiv) {
            const isOn = toggleDiv.classList.contains('bg-[#675F57]');
            hiddenInput.value = isOn ? 'Yes' : 'No';
            valueSet = true;
          }
        }
        
        // Method 3: Default to "No" if still not set
        if (!valueSet || !hiddenInput.value) {
          hiddenInput.value = 'No';
        }
      }
    });
  }

  // Function to submit/update data to Airtable immediately
  function submitToAirtable(data, email = null) {
    // Airtable API configuration
    const AIRTABLE_BASE_ID = 'appmdc27WmH4DfYcm';
    const AIRTABLE_TABLE_NAME = 'Helpers';
    const AIRTABLE_API_KEY = 'patJhPHpdtzafBrO3.9ba453f10d0deb3606bbb6872ebabf42e32d912913b97611f2e826c277ed3b78';
    const airtableUrl = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`;
    
    // Use email as identifier if available
    if (!email) {
      email = data['data[Email]'] || null;
    }
    
    // Get session ID from localStorage (if exists from page 1)
    const sessionId = localStorage.getItem('surveySessionId');
    
    // Log the raw data received
    console.log('ðŸ” Page 7 - Raw data received:', data);
    console.log('ðŸ” Page 7 - Data keys:', Object.keys(data));
    
    // Map form data to Airtable field names
    const fields = {};
    
    // Helper function to safely get and convert field value
    // Only return value if it's not empty and not "Not Selected Yet"
    function getFieldValue(key) {
      const value = data[key];
      if (value !== undefined && value !== null && value !== '') {
        const strValue = String(value).trim();
        // Don't update if value is "Not Selected Yet" (keep existing value in Airtable)
        if (strValue !== 'Not Selected Yet' && strValue !== '') {
          return strValue;
        }
      }
      return null;
    }
    
    // Field mapping from form data[FieldName] to Airtable field names
    // Only update fields that have actual values (not "Not Selected Yet")
    const duration = getFieldValue('data[Duration]');
    if (duration) fields['Duration'] = duration;
    
    const study = getFieldValue('data[Study]');
    if (study) fields['Study'] = study;
    
    const age = getFieldValue('data[Age]');
    if (age) fields['Age'] = age;
    
    const gender = getFieldValue('data[Gender]');
    if (gender) fields['Gender'] = gender;
    
    const local = getFieldValue('data[Local]');
    if (local) fields['Local'] = local; // Long text
    
    const helpArea = getFieldValue('data[HelpArea]');
    if (helpArea) fields['HelpArea'] = helpArea; // Long text
    
    // Toggle switches - only update if they have actual values (Yes/No)
    const pets = getFieldValue('data[Pets]');
    if (pets && (pets === 'Yes' || pets === 'No')) {
      fields['Pets'] = pets;
    }
    
    const contribute = getFieldValue('data[Contribute]');
    if (contribute && (contribute === 'Yes' || contribute === 'No')) {
      fields['Contribute'] = contribute;
    }
    
    const car = getFieldValue('data[Car]');
    if (car && (car === 'Yes' || car === 'No')) {
      fields['Car'] = car;
    }
    
    const reference = getFieldValue('data[Reference]');
    if (reference && (reference === 'Yes' || reference === 'No')) {
      fields['Reference'] = reference;
    }
    
    const degree = getFieldValue('data[Degree]');
    if (degree && (degree === 'Yes' || degree === 'No')) {
      fields['Degree'] = degree;
    }
    
    const zipCode = getFieldValue('data[Zip]');
    if (zipCode) fields['ZipCode'] = zipCode;
    
    const name = getFieldValue('data[Name]');
    if (name) fields['Name'] = name;
    
    const emailValue = getFieldValue('data[Email]');
    if (emailValue) fields['Email'] = emailValue;
    
    const selectedPlan = getFieldValue('data[Selected Plan]');
    if (selectedPlan) fields['Selected Plan'] = selectedPlan;
    
    // Note: Session Id is autonumber in Airtable, so we don't set it here
    // It will be auto-generated by Airtable when the record is created
    
    // Prepare Airtable record payload
    const payload = {
      fields: fields
    };
    
    const headers = {
      'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
      'Content-Type': 'application/json'
    };
    
    // Function to find existing record - prioritize stored record ID from page 1
    function findExistingRecord(callback) {
      // First, try to use the record ID stored from page 1
      const storedRecordId = localStorage.getItem('airtableRecordId');
      console.log('ðŸ” Page 7 - Checking for stored record ID:', storedRecordId);
      
      if (storedRecordId) {
        console.log('ðŸ” Page 7 - Using stored record ID from page 1:', storedRecordId);
        // Verify the record still exists
        fetch(`${airtableUrl}/${storedRecordId}`, {
          method: 'GET',
          headers: headers,
          keepalive: true
        })
        .then(response => {
          console.log('ðŸ“¡ Page 7 - Stored ID verification response:', response.status, response.statusText);
          if (response.ok) {
            return response.json();
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        })
        .then(record => {
          console.log('âœ… Page 7 - Stored record ID is valid:', storedRecordId);
          console.log('ðŸ“‹ Stored record data:', record);
          callback(storedRecordId);
        })
        .catch((error) => {
          console.log('âš ï¸ Page 7 - Stored record ID verification failed:', error);
          console.log('âš ï¸ Page 7 - Trying other methods...');
          findRecordByOtherMethods(callback);
        });
      } else {
        console.log('âš ï¸ Page 7 - No stored record ID found in localStorage');
        console.log('âš ï¸ Page 7 - Available localStorage keys:', Object.keys(localStorage));
        // No stored ID, try other methods
        findRecordByOtherMethods(callback);
      }
    }
    
    // Helper function to find record by email or page 1 data
    function findRecordByOtherMethods(callback) {
      // First, try to find by email if available
      if (email) {
        const filterFormula = `{Email} = "${email}"`;
        fetch(`${airtableUrl}?filterByFormula=${encodeURIComponent(filterFormula)}`, {
          method: 'GET',
          headers: headers,
          keepalive: true
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          return response.json();
        })
        .then(result => {
          if (result.records && result.records.length > 0) {
            console.log('âœ… Found record by email:', result.records[0].id);
            // Store this ID for future use
            localStorage.setItem('airtableRecordId', result.records[0].id);
            callback(result.records[0].id);
          } else {
            // Email not found, try to find by matching page 1 data (record without email)
            console.log('ðŸ” Email not found, trying to find record by page 1 data...');
            findRecordByPage1Data(callback);
          }
        })
        .catch((error) => {
          console.error('âŒ Error finding record by email:', error);
          // Try to find by page 1 data as fallback
          findRecordByPage1Data(callback);
        });
      } else {
        // No email, try to find by page 1 data
        findRecordByPage1Data(callback);
      }
    }
    
    // Helper function to find record by matching page 1 data
    function findRecordByPage1Data(callback) {
      const duration = data['data[Duration]'] || '';
      const study = data['data[Study]'] || '';
      const age = data['data[Age]'] || '';
      const gender = data['data[Gender]'] || '';
      
      console.log('ðŸ” Page 7 - Searching by page 1 data:', { duration, study, age, gender });
      
      // Only try to match if we have enough data from page 1
      if (duration && study && age && gender) {
        // First try: Find record matching these exact fields
        // Escape special characters in values for Airtable formula
        const escapeValue = (val) => val.replace(/"/g, '\\"');
        const matchFormula1 = `AND({Duration} = "${escapeValue(duration)}", {Study} = "${escapeValue(study)}", {Age} = "${escapeValue(age)}", {Gender} = "${escapeValue(gender)}")`;
        
        console.log('ðŸ” Page 7 - Trying match formula 1:', matchFormula1);
        
        fetch(`${airtableUrl}?filterByFormula=${encodeURIComponent(matchFormula1)}&maxRecords=1&sort[0][field]=Session Id&sort[0][direction]=desc`, {
          method: 'GET',
          headers: headers,
          keepalive: true
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          return response.json();
        })
        .then(result => {
          if (result.records && result.records.length > 0) {
            console.log('âœ… Found record by page 1 data (method 1):', result.records[0].id);
            // Store this ID for future use
            localStorage.setItem('airtableRecordId', result.records[0].id);
            callback(result.records[0].id);
          } else {
            // Try method 2: Find most recent record with matching Duration and Study
            console.log('ðŸ” Method 1 failed, trying method 2...');
            const matchFormula2 = `AND({Duration} = "${duration}", {Study} = "${study}")`;
            return fetch(`${airtableUrl}?filterByFormula=${encodeURIComponent(matchFormula2)}&maxRecords=1&sort[0][field]=Session Id&sort[0][direction]=desc`, {
              method: 'GET',
              headers: headers,
              keepalive: true
            });
          }
        })
        .then(response => {
          if (response && response.ok) {
            return response.json();
          }
          return { records: [] };
        })
        .then(result => {
          if (result.records && result.records.length > 0) {
            console.log('âœ… Found record by page 1 data (method 2):', result.records[0].id);
            localStorage.setItem('airtableRecordId', result.records[0].id);
            callback(result.records[0].id);
          } else {
            // Last resort: Get the most recent record (should be the one from page 1)
            console.log('ðŸ” Method 2 failed, trying to get most recent record...');
            return fetch(`${airtableUrl}?maxRecords=1&sort[0][field]=Session Id&sort[0][direction]=desc`, {
              method: 'GET',
              headers: headers,
              keepalive: true
            });
          }
        })
        .then(response => {
          if (response && response.ok) {
            return response.json();
          }
          return { records: [] };
        })
        .then(result => {
          if (result.records && result.records.length > 0) {
            console.log('âœ… Found most recent record (method 3):', result.records[0].id);
            localStorage.setItem('airtableRecordId', result.records[0].id);
            callback(result.records[0].id);
          } else {
            console.error('âŒ Page 7 - CRITICAL: Could not find ANY record to update!');
            console.error('âŒ This should not happen - page 1 should have created a record');
            // Don't create new record - this is an error condition
            callback(null);
          }
        })
        .catch((error) => {
          console.error('âŒ Error finding record by page 1 data:', error);
          callback(null);
        });
      } else {
        console.log('âŒ Not enough page 1 data to match');
        // Try to get most recent record as last resort
        fetch(`${airtableUrl}?maxRecords=1&sort[0][field]=Session Id&sort[0][direction]=desc`, {
          method: 'GET',
          headers: headers,
          keepalive: true
        })
        .then(response => response.json())
        .then(result => {
          if (result.records && result.records.length > 0) {
            console.log('âœ… Found most recent record as fallback:', result.records[0].id);
            localStorage.setItem('airtableRecordId', result.records[0].id);
            callback(result.records[0].id);
          } else {
            callback(null);
          }
        })
        .catch(() => callback(null));
      }
    }
    
    // Log the payload being sent
    console.log('ðŸ“¤ Page 7 - Sending to Airtable:', payload);
    console.log('ðŸ“‹ Page 7 - Fields being sent:', fields);
    console.log('ðŸ“‹ Page 7 - Fields count:', Object.keys(fields).length);
    console.log('ðŸ“§ Page 7 - Email for lookup:', email);
    
    // Validate that we have fields to send
    if (Object.keys(fields).length === 0) {
      console.error('âŒ Page 7 - ERROR: No fields to send! Data object:', data);
      console.error('âŒ Page 7 - Data keys available:', Object.keys(data));
      return; // Don't send empty payload
    }
    
    // Try to find and update existing record, otherwise create new one
    findExistingRecord((recordId) => {
      console.log('ðŸ” Page 7 - Record lookup result:', recordId ? `Found: ${recordId}` : 'Not found, will create new');
      
      if (recordId) {
        updateRecord(recordId);
      } else {
        // CRITICAL: We should NEVER create a new record on page 7
        // If we can't find the record, something is wrong
        console.error('âŒ Page 7 - CRITICAL ERROR: Could not find existing record!');
        console.error('âŒ Page 7 - This means page 1 record was not found');
        console.error('âŒ Page 7 - Stored record ID:', localStorage.getItem('airtableRecordId'));
        console.error('âŒ Page 7 - Email used for lookup:', email);
        console.error('âŒ Page 7 - Page 1 data available:', {
          duration: data['data[Duration]'],
          study: data['data[Study]'],
          age: data['data[Age]'],
          gender: data['data[Gender]']
        });
        
        // Try one more time with a simpler lookup - get most recent record
        console.log('ðŸ”„ Page 7 - Last attempt: Getting most recent record...');
        fetch(`${airtableUrl}?maxRecords=1&sort[0][field]=Session Id&sort[0][direction]=desc`, {
          method: 'GET',
          headers: headers,
          keepalive: true
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          return response.json();
        })
        .then(result => {
          if (result.records && result.records.length > 0) {
            const recordId = result.records[0].id;
            console.log('âœ… Page 7 - Found most recent record as last resort:', recordId);
            localStorage.setItem('airtableRecordId', recordId);
            // Update this record
            updateRecord(recordId);
          } else {
            console.error('âŒ Page 7 - No records exist in Airtable at all!');
            // Still don't create - this is an error, but redirect anyway
            window.location.href = "guest-pricing-page.html";
          }
        })
        .catch((error) => {
          console.error('âŒ Page 7 - Final lookup attempt failed:', error);
          // Redirect anyway - don't block user
          window.location.href = "guest-pricing-page.html";
        });
      }
    });
    
    // Helper function to update an existing record
    function updateRecord(recordId) {
      console.log('ðŸ”„ Page 7 - Updating existing record:', recordId);
      console.log('ðŸ“¤ Page 7 - Update payload:', JSON.stringify(payload, null, 2));
      
      // Update existing record
      fetch(`${airtableUrl}/${recordId}`, {
        method: 'PATCH',
        headers: headers,
        body: JSON.stringify(payload),
        keepalive: true
      })
      .then(response => {
        console.log('ðŸ“¡ Page 7 - Update response status:', response.status, response.statusText);
        
        if (!response.ok) {
          return response.json().then(err => {
            console.error('âŒ Page 7 - Update error response:', err);
            console.error('âŒ Page 7 - Full error:', JSON.stringify(err, null, 2));
            throw new Error(`HTTP ${response.status}: ${JSON.stringify(err)}`);
          });
        }
        return response.json();
      })
      .then(result => {
        console.log('âœ… Page 7 - Airtable record updated successfully!');
        console.log('ðŸ“‹ Updated record:', JSON.stringify(result, null, 2));
        // Redirect immediately - API call uses keepalive so it will complete
        window.location.href = "guest-pricing-page.html";
      })
      .catch((error) => {
        console.error('âŒ Page 7 - Airtable update failed:', error);
        console.error('ðŸ“‹ Error details:', error.message);
        console.error('ðŸ“‹ Full error:', error);
        // Don't create new record - redirect anyway (don't block user)
        window.location.href = "guest-pricing-page.html";
      });
    }
    
    // Helper function to create a new record (should NEVER be called on page 7)
    function createNewRecord() {
      console.log('ðŸ“¤ Page 7 - Create payload:', JSON.stringify(payload, null, 2));
      console.log('ðŸ“¤ Page 7 - API URL:', airtableUrl);
      
      fetch(airtableUrl, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(payload),
        keepalive: true
      })
      .then(response => {
        console.log('ðŸ“¡ Page 7 - Create response status:', response.status, response.statusText);
        console.log('ðŸ“¡ Page 7 - Create response headers:', response.headers);
        
        if (!response.ok) {
          return response.json().then(err => {
            console.error('âŒ Page 7 - Create error response:', err);
            console.error('âŒ Page 7 - Full error:', JSON.stringify(err, null, 2));
            throw new Error(`HTTP ${response.status}: ${JSON.stringify(err)}`);
          });
        }
        return response.json();
      })
      .then(result => {
        console.log('âœ… Page 7 - Airtable record created successfully!');
        console.log('ðŸ“‹ Created record:', JSON.stringify(result, null, 2));
        // Store the new record ID
        if (result && result.id) {
          localStorage.setItem('airtableRecordId', result.id);
          console.log('ðŸ’¾ Page 7 - Stored new record ID:', result.id);
        }
        // Redirect immediately - API call uses keepalive so it will complete
        window.location.href = "guest-pricing-page.html";
      })
      .catch((error) => {
        console.error('âŒ Page 7 - Airtable create failed:', error);
        console.error('ðŸ“‹ Error details:', error.message);
        console.error('ðŸ“‹ Full error object:', error);
        console.error('ðŸ“‹ Payload was:', JSON.stringify(payload, null, 2));
        console.error('ðŸ“‹ Fields sent:', JSON.stringify(fields, null, 2));
        // Still redirect even on error (user shouldn't be stuck)
        window.location.href = "guest-pricing-page.html";
      });
    }
  }

  // Handle form submission
  const form = document.getElementById("surveyForm7");
  form.addEventListener("submit", (e) => {
    // Check if button is active (not disabled)
    if (submitBtn.classList.contains("opacity-30") || submitBtn.classList.contains("cursor-not-allowed")) {
      e.preventDefault();
      return false; // Don't submit if button is inactive
    }
    
    // Validate zip code before submitting
    if (zipCode && !validateZipCode()) {
      e.preventDefault();
      zipCode.focus();
      return false;
    }
    
    // Validate email before submitting
    const email = document.getElementById("emailInput")?.value.trim() || "";
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      e.preventDefault();
      alert('Please enter a valid email address');
      emailInput?.focus();
      return false;
    }
    
    // Prevent default form submission
    e.preventDefault();
    
    // Prevent multiple submissions
    if (submitBtn.disabled) {
      e.preventDefault();
      return false;
    }
    submitBtn.disabled = true;
    
    // Sync all toggle values before collecting data (fixes degree toggle issue)
    syncAllToggleValues();
    
    // Wait a bit for Alpine.js to update the hidden inputs
    setTimeout(() => {
      // Collect form data and merge with page 1 data
      const formData = new FormData(form);
      const page7Data = {};
      
      // Convert FormData to object - ensure proper key format
      for (const [key, value] of formData.entries()) {
        if (key && key.startsWith('data[') && key.endsWith(']')) {
          // Ensure the key is properly formatted
          const cleanKey = key.trim();
          if (cleanKey && value !== null && value !== undefined) {
            page7Data[cleanKey] = String(value).trim();
          }
        }
      }
      
      // Manually capture toggle values if they're not in FormData
      const toggleInputs = form.querySelectorAll('input[type="hidden"][data-toggle]');
      toggleInputs.forEach(input => {
        const name = input.getAttribute('name');
        if (name && name.startsWith('data[') && name.endsWith(']')) {
          let toggleValue = 'No'; // Default
          
          // Get the value from Alpine.js or from the input directly
          try {
            if (window.Alpine && Alpine.$data) {
              const container = input.closest('[x-data]');
              if (container) {
                const alpineData = Alpine.$data(container);
                if (alpineData && typeof alpineData.on !== 'undefined') {
                  toggleValue = alpineData.on ? 'Yes' : 'No';
                }
              }
            }
          } catch (e) {
            // Fallback to input value
            if (input.value && input.value.trim() !== '') {
              toggleValue = input.value.trim();
            }
          }
          
          page7Data[name] = toggleValue;
        }
      });
      
      // Also capture text inputs (Name, Email, Zip) directly
      const nameInput = document.getElementById('firstNameInput');
      if (nameInput && nameInput.value) {
        page7Data['data[Name]'] = nameInput.value.trim();
      }
      
      const emailInput = document.getElementById('emailInput');
      if (emailInput && emailInput.value) {
        page7Data['data[Email]'] = emailInput.value.trim();
      }
      
      const zipInput = document.getElementById('zipCodeInput');
      if (zipInput && zipInput.value) {
        page7Data['data[Zip]'] = zipInput.value.trim();
      }
      
      // Get page 1 data from localStorage and merge
      const existingData = JSON.parse(localStorage.getItem('surveyData') || '{}');
      const allData = { ...existingData, ...page7Data };
      
      // Clean up any malformed keys
      const cleanedData = {};
      for (const [key, value] of Object.entries(allData)) {
        if (key && typeof key === 'string' && key.startsWith('data[') && key.endsWith(']')) {
          cleanedData[key] = value;
        }
      }
      
      // Store merged data in localStorage
      localStorage.setItem('surveyData', JSON.stringify(cleanedData));

      // Log the data being sent
      console.log('ðŸ“Š Page 7 - Cleaned data to send:', cleanedData);
      console.log('ðŸ“Š Page 7 - Data keys:', Object.keys(cleanedData));
      console.log('ðŸ“§ Page 7 - Email:', email);
      
      // Submit all data immediately to Airtable using email as identifier
      submitToAirtable(cleanedData, email);
      
      // Don't redirect immediately - wait for API call to complete
      // The redirect will happen after successful API call
    }, 200);
  });
});
</script>




<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>


</body>


</html>